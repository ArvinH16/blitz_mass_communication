# Attendance Tracking Feature - PRD

## Overview
Implement a system to track student attendance for organization events. Administrators can create events and generate QR codes. Students scan these QR codes to check in using their phone numbers.

## User Flows

### 1. Administrator (Event Creation)
1.  Admin navigates to the "Events" section.
2.  Clicks "Create Event".
3.  Enters event name, date, and time.
4.  System generates a unique "Check-in" URL and a displayable QR code.
5.  Admin can print or project the QR code for students to scan.

### 2. Student (Check-in)
1.  Student scans the QR code (or visits the link).
2.  Lands on a simple mobile-friendly page: `'/check-in/[eventId]'`.
3.  Enters their phone number.
4.  Clicks "Check In".
5.  **System checks membership**:
    *   **If member exists**: System marks attendance. Displays "You are checked in!".
    *   **If member does NOT exist**:
        1.  System prompts user for **First Name**, **Last Name**, and **Email**.
        2.  User enters details and clicks "Confirm Attendance".
        3.  System creates a new member profile.
        4.  System marks attendance.
        5.  Displays "You are checked in!".

### 3. Administrator (Review)
1.  Admin views the Event details page.
2.  Sees a list or count of members who have attended.

## Database Schema Changes

We need two new tables to support this feature.

### 1. `events`
Stores information about each event.

```sql
create table events (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  organization_id bigint references organizations(id) not null,
  name text not null,
  description text,
  event_date timestamp with time zone not null,
  code text unique default uuid_generate_v4() -- Unique code for the specific event URL
);
```

### 2. `attendance`
Links members to events when they check in.

```sql
create table attendance (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  event_id bigint references events(id) not null,
  member_id bigint references org_members(id) not null,
  status text default 'attended', -- Could be 'attended', 'excused', etc.
  unique(event_id, member_id) -- Prevent duplicate check-ins
);
```

## Frontend Pages

### 1. Admin: Event Management (`/events`)
*   **List View**: Show upcoming and past events.
*   **Create View**: Form to add new event.
*   **Detail View**:
    *   Show QR Code (use a library like `qrcode.react`).
    *   Show URL (`window.location.origin + /check-in/${event.code}`).
    *   Table of attendees.

### 2. Public: Student Check-in (`/check-in/[code]`)
*   **Layout**: Minimalist, mobile-focused.
*   **Step 1**: Input field for Phone Number.
*   **Step 2 (Conditional)**: If phone not found, show fields for First Name, Last Name, Email.
*   **Interaction**:
    *   Submit Phone -> API Search.
    *   If 200 OK -> Success Screen.
    *   If 404 Not Found -> Show Registration Form.
    *   Submit Registration -> API Create & Check-in -> Success Screen.

## Backend / API Requirements

### 1. `POST /api/events`
*   Creates a new event for the logged-in organization.

### 2. `POST /api/attendance`
*   **Input**: 
    ```json
    { 
      "eventCode": "string", 
      "phoneNumber": "string", 
      "firstName": "string (optional)", 
      "lastName": "string (optional)", 
      "email": "string (optional)"
    }
    ```
*   **Logic**:
    1.  Find `event` by `eventCode`.
    2.  Find `org_member` by `phoneNumber` AND `event.organization_id`.
    3.  **If member exists**:
        *   Insert into `attendance` table (if not already there).
        *   Return Success.
    4.  **If member does NOT exist**:
        *   If `firstName`, `lastName`, and `email` are **provided**:
            *   Create new `org_member` for this organization.
            *   Insert into `attendance` table.
            *   Return Success.
        *   If details **missing**:
            *   Return Error / Status indicating "Member not found, details required".

## Implementation Plan

1.  **Database**: Run SQL migrations to create `events` and `attendance` tables.
2.  **API**: Create the server actions or API routes for event creation and attendance submission.
3.  **Frontend (Admin)**: Build the Event Dashboard (List, Create, Details/QR).
4.  **Frontend (Public)**: Build the Check-in Page.
5.  **Testing**: Verify flow with a real phone number and dummy member data.
