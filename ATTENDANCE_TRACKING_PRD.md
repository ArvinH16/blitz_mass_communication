# Attendance Tracking Feature - PRD

## Overview
Implement a system to track student attendance for organization events. Administrators can create events and generate QR codes. Students scan these QR codes to check in using their phone numbers.

## User Flows

### 1. Administrator (Event Creation)
1.  Admin navigates to the "Events" section.
2.  Clicks "Create Event".
3.  Enters event name, date, and time.
4.  System generates a unique "Check-in" URL and a displayable QR code.
5.  Admin can print or project the QR code for students to scan.

### 2. Student (Check-in)
1.  Student scans the QR code (or visits the link).
2.  Lands on a simple mobile-friendly page: `'/check-in/[eventId]'`.
3.  Enters their phone number.
4.  Clicks "Check In".
5.  System verifies:
    *   Is the phone number associated with a member of the organization hosting the event?
    *   Has the student already checked in?
6.  Success message: "You are checked in!" OR Error message.

### 3. Administrator (Review)
1.  Admin views the Event details page.
2.  Sees a list or count of members who have attended.

## Database Schema Changes

We need two new tables to support this feature.

### 1. `events`
Stores information about each event.

```sql
create table events (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  organization_id bigint references organizations(id) not null,
  name text not null,
  description text,
  event_date timestamp with time zone not null,
  code text unique default uuid_generate_v4() -- Unique code for the specific event URL
);
```

### 2. `attendance`
Links members to events when they check in.

```sql
create table attendance (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  event_id bigint references events(id) not null,
  member_id bigint references org_members(id) not null,
  status text default 'attended', -- Could be 'attended', 'excused', etc.
  unique(event_id, member_id) -- Prevent duplicate check-ins
);
```

## Frontend Pages

### 1. Admin: Event Management (`/events`)
*   **List View**: Show upcoming and past events.
*   **Create View**: Form to add new event.
*   **Detail View**:
    *   Show QR Code (use a library like `qrcode.react`).
    *   Show URL (`window.location.origin + /check-in/${event.code}`).
    *   Table of attendees.

### 2. Public: Student Check-in (`/check-in/[code]`)
*   **Layout**: Minimalist, mobile-focused.
*   **Form**: Input field for Phone Number.
*   **Logic**:
    *   Clean phone number input.
    *   Call API to verify and mark attendance.

## Backend / API Requirements

### 1. `POST /api/events`
*   Creates a new event for the logged-in organization.

### 2. `POST /api/attendance`
*   **Input**: `{ eventCode: string, phoneNumber: string }`
*   **Logic**:
    1.  Find `event` by `eventCode`.
    2.  Find `org_member` by `phoneNumber` AND `event.organization_id`.
    3.  If member not found -> Return Error ("Member not found. Please register with the organization first.").
    4.  If already in `attendance` -> Return Success/Info ("Already checked in").
    5.  Insert into `attendance` table.
    6.  Return Success.

## Implementation Plan

1.  **Database**: Run SQL migrations to create `events` and `attendance` tables.
2.  **API**: Create the server actions or API routes for event creation and attendance submission.
3.  **Frontend (Admin)**: Build the Event Dashboard (List, Create, Details/QR).
4.  **Frontend (Public)**: Build the Check-in Page.
5.  **Testing**: Verify flow with a real phone number and dummy member data.
